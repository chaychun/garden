---
import ArticleBlock from "@/components/blocks/ArticleBlock.astro";
import PreviewBlock from "@/components/blocks/PreviewBlock.astro";
import HorizontalScrollLayout from "@/layouts/HorizontalScrollLayout.astro";
import { getCollection } from "astro:content";

const interactions = await getCollection("interactions");
const articles = await getCollection("articles");

const allItems = [
	...interactions.map((item) => ({ ...item, type: "interaction" })),
	...articles.map((item) => ({ ...item, type: "article" })),
].sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<HorizontalScrollLayout
	title="Test page"
	sidebar="home"
	scrollAreaId="main-scroll"
>
	{
		allItems.map((item) => {
			const formattedDate = item.data.date.toLocaleDateString("en-US", {
				year: "numeric",
				month: "short",
				day: "numeric",
			});

			if (item.type === "interaction") {
				return (
					<PreviewBlock
						{...item.data}
						date={formattedDate}
						bgImage={"bgImage" in item.data ? item.data.bgImage || "" : ""}
						previewImage={item.data.previewImage ?? ""}
					/>
				);
			} else {
				return (
					<ArticleBlock
						{...item.data}
						date={formattedDate}
						link={`/articles/${item.id}/`}
					/>
				);
			}
		})
	}
</HorizontalScrollLayout>
