---
export const prerender = false;

import ArticleBlock from "@/components/blocks/ArticleBlock.astro";
import PreviewBlock from "@/components/blocks/PreviewBlock.astro";
import HorizontalScrollLayout from "@/layouts/HorizontalScrollLayout.astro";
import { getCollection } from "astro:content";

const interactions = await getCollection("interactions");
const articles = await getCollection("articles");

const allItems = [...interactions, ...articles].sort(
	(a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const filterParam = Astro.url.searchParams.get("filter") || "all";

let filteredItems = allItems;
if (filterParam !== "all") {
	filteredItems = allItems.filter((item) => item.collection === filterParam);
}
---

<HorizontalScrollLayout
	title="Test page"
	sidebar="home"
	scrollAreaId="main-scroll"
>
	{
		filteredItems.map((item) => {
			const formattedDate = item.data.date.toLocaleDateString("en-US", {
				year: "numeric",
				month: "short",
				day: "numeric",
			});

			if (item.collection === "interactions") {
				return (
					<PreviewBlock
						{...item.data}
						date={formattedDate}
						bgImage={"bgImage" in item.data ? item.data.bgImage || "" : ""}
						previewImage={item.data.previewImage ?? ""}
					/>
				);
			} else {
				return (
					<ArticleBlock
						{...item.data}
						date={formattedDate}
						link={`/articles/${item.id}/`}
					/>
				);
			}
		})
	}
</HorizontalScrollLayout>
