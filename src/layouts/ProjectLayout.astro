---
import ProjectSidebar from "@/components/nav/ProjectSidebar";
import BaseLayout from "./BaseLayout.astro";
import InfoDrawer from "@/components/nav/InfoDrawer";

interface Props {
	title: string;
	description: string;
	createdDate: string;
	lastUpdatedDate: string;
	types: string[];
	disableSidebarClickOutside?: boolean;
	floatingSidebar?: boolean;
}

const {
	title,
	description,
	createdDate,
	lastUpdatedDate,
	types,
	disableSidebarClickOutside,
	floatingSidebar = false,
} = Astro.props;
---

<BaseLayout title={title}>
	<div class="bg-base-50 flex h-dvh">
		<div
			class:list={[
				"hidden min-[824px]:block",
				floatingSidebar
					? "min-[824px]:absolute min-[824px]:inset-y-0 min-[824px]:left-0 min-[824px]:z-9999"
					: "",
			]}
		>
			<ProjectSidebar
				client:media="(min-width: 824px)"
				title={title}
				description={description}
				createdDate={createdDate}
				lastUpdatedDate={lastUpdatedDate}
				types={types}
				disableClickOutside={disableSidebarClickOutside}
			>
				<slot />
			</ProjectSidebar>
		</div>
		<div
			id="content-area"
			class:list={[
				"flex w-full flex-1 flex-col overflow-hidden pl-0 min-[824px]:overflow-auto",
				floatingSidebar
					? "min-[824px]:ml-16"
					: "min-[824px]:p-4 min-[824px]:pl-0",
			]}
		>
			<slot name="interactive">
				<div
					class="bg-base-100 flex h-full items-center justify-center p-0 min-[824px]:p-4"
				>
					<div class="text-base-500 w-full text-center">
						<h2 class="mb-2 text-2xl font-medium">Interactive Content Area</h2>
						<p class="text-sm">Interactive components will be rendered here</p>
					</div>
				</div></slot
			>
			<div class="block min-[824px]:hidden">
				<InfoDrawer
					client:media="(max-width: 823px)"
					title={title}
					description={description}
					createdDate={createdDate}
					lastUpdatedDate={lastUpdatedDate}
					types={types}
				>
					<slot />
				</InfoDrawer>
			</div>
		</div>
	</div>
</BaseLayout>

<script>
	import { useSidebarStore } from "@/lib/stores/sidebarStore";

	const handlePageLoad = () => {
		try {
			useSidebarStore.getState().setExpanded(true);
		} catch (error) {
			console.warn("Failed to force open sidebar on interaction page:", error);
		}
	};

	document.addEventListener("astro:page-load", handlePageLoad);

	document.addEventListener("astro:before-swap", () => {
		document.removeEventListener("astro:page-load", handlePageLoad);
	});
</script>
