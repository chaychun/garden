---
import Widget from "@/components/widgets/Widget.astro";
import { toCssHeight } from "@/lib/utils";
import { getCldImageUrl } from "astro-cloudinary/helpers";

interface Props {
	title: string;
	image: string;
	description?: string;
	types?: string[];
	id?: string;
	alt?: string;
	height?: string | number;
	[key: string]: any;
}

const { title, image, description, types, id, alt, height, ...rest } =
	Astro.props;

const imageUrl = getCldImageUrl({ src: image, width: 1200, format: "auto" });
const href = id ? `/project/${encodeURIComponent(id)}/` : undefined;

const mediaHeightCss = toCssHeight(height);
const mediaWrapperStyle = `--media-h:${mediaHeightCss};`;
---

<Widget
	class:list={[
		"flex max-w-[528px] flex-col gap-3 md:max-w-none md:justify-start",
		"mb-12 md:mb-0",
	]}
	{...rest}
>
	<div
		class:list={["md:h-[var(--media-h)] md:min-h-[300px]"]}
		style={mediaWrapperStyle}
	>
		{
			href ? (
				<a
					href={href}
					class="block md:h-full md:w-full"
					aria-label={`View ${title}`}
					data-cursor-hover
					data-cursor-title={title}
				>
					<img
						src={imageUrl}
						alt={alt || title}
						loading="lazy"
						decoding="async"
						class="h-auto w-full md:h-full md:w-auto md:max-w-full"
					/>
				</a>
			) : (
				<div
					class="block md:h-full md:w-full"
					data-cursor-hover
					data-cursor-title={title}
				>
					<img
						src={imageUrl}
						alt={alt || title}
						loading="lazy"
						decoding="async"
						class="h-auto w-full md:h-full md:w-auto md:max-w-full"
					/>
				</div>
			)
		}
	</div>
</Widget>
