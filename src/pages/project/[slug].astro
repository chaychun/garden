---
import ProjectLayout from "@/layouts/ProjectLayout.astro";
import type { AstroInstance } from "astro";
import { getCollection, render } from "astro:content";

export const getStaticPaths = async () => {
	const entries = await getCollection("projects");
	return entries
		.filter((entry) => entry.data.widget?.type !== "interactive")
		.map((entry) => ({
			params: { slug: entry.id },
			props: { entry },
		}));
};

const { entry } = Astro.props;
const { Content } = await render(entry);

const interactiveModules = import.meta.glob<AstroInstance>(
	"../../projects/*/*.astro",
	{ eager: true },
);
const key = `../../projects/${entry.id}/${entry.id}.astro`;
let ComponentToRender: AstroInstance["default"] | null = null;
if (key in interactiveModules) {
	ComponentToRender = interactiveModules[key].default;
}
---

<ProjectLayout
	title={entry.data.title}
	description={entry.data.description}
	createdDate={entry.data.createdDate.toISOString()}
	lastUpdatedDate={entry.data.lastUpdatedDate.toISOString()}
	types={entry.data.types || []}
>
	{ComponentToRender && <ComponentToRender slot="interactive" />}
	<Content />
</ProjectLayout>
