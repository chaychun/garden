---
import Badge from "@/components/Badge.astro";
import Block from "@/components/blocks/Block.astro";

interface Props {
	title: string;
	description: string;
	date: string;
	bgImage: string;
	previewVideo: string;
	position?: "top" | "bottom";
	orientation?: "portrait" | "landscape";
	tags?: string[];
	id: string;
	[key: string]: any;
}

const {
	title,
	description,
	date,
	bgImage,
	previewVideo,
	position = "top",
	orientation = "portrait",
	tags,
	id,
	...rest
} = Astro.props;

const assetModules = import.meta.glob(
	"/src/**/*.{jpg,jpeg,png,gif,webp,mp4,webm,mov}",
	{
		eager: true,
	},
) as Record<string, { default: { src: string } }>;

function getAssetUrl(path: string): string {
	if (path.startsWith("https://") || path.startsWith("http://")) {
		return path;
	}

	let importPath = path;
	if (path.startsWith("/src/")) {
		importPath = path;
	} else if (!path.startsWith("/")) {
		importPath = `/src/${path}`;
	}

	const module = assetModules[importPath];
	if (module) {
		return module.default.src;
	}

	console.warn(`Asset not found: ${path}`);
	return path;
}

const bgImageUrl = getAssetUrl(bgImage);
const previewVideoUrl = getAssetUrl(previewVideo);
---

<Block
	class:list={[
		"flex flex-col gap-4 p-6 md:justify-between",
		"mb-12 md:mb-0",
		position === "bottom" && "md:flex-col-reverse",
	]}
	{...rest}
>
	<a href={`/interactions/${id}/`} class="block" aria-label={`View ${title}`}>
		<div
			class:list={[
				"group relative flex w-full items-center justify-center",
				orientation === "portrait" && "aspect-4/5",
				orientation === "landscape" && "aspect-5/4",
			]}
			style={{
				backgroundImage: `url(${bgImageUrl})`,
				backgroundSize: "cover",
			}}
		>
			{
				tags && tags.length > 0 && (
					<div class="absolute top-2 right-2 flex gap-2 opacity-100 transition-opacity duration-300 md:opacity-0 md:group-hover:opacity-100">
						{tags.map((tag) => (
							<Badge text={tag} />
						))}
					</div>
				)
			}
			<video
				src={previewVideoUrl}
				class="h-auto w-[90%]"
				loop
				muted
				autoplay
				playsinline></video>
		</div>
	</a>
	<div class="flex flex-col gap-1 md:w-[480px]">
		<p class="font-switzer text-base-300 text-sm">{date}</p>
		<h2 class="font-cabinet text-base-900 text-3xl leading-none font-medium">
			{title}
		</h2>
		<p class="font-switzer text-base-500 mt-2 text-sm leading-tight">
			{description}
		</p>
	</div>
</Block>
