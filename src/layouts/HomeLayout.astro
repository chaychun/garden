---
import BaseLayout from "./BaseLayout.astro";
import Header from "@/components/nav/home-header";
import type { FilterType } from "@/lib/content-types";

interface Props {
	title: string;
	scrollAreaId?: string;
	filterCounts: Record<FilterType, number>;
}

const { title, scrollAreaId = "main-scroll", filterCounts } = Astro.props;
---

<BaseLayout title={title}>
	<div class="bg-base-50 flex h-dvh flex-col justify-between">
		<Header title="Chayut" filterCounts={filterCounts} client:only="react" />

		<div
			class="p-4 md:flex md:max-h-3/4 md:overflow-x-auto md:overflow-y-hidden"
			id="scroll-container"
			data-scroll-area-id={scrollAreaId}
		>
			<div
				class="mx-auto flex max-w-[528px] flex-col md:mx-0 md:max-w-none md:flex-row md:*:pr-4"
			>
				<slot />
			</div>
		</div>

		<script>
			import {
				setupHorizontalScrollSmoothing,
				setupVerticalScrollSmoothing,
			} from "../lib/scroll-smoothing";

			let currentCleanup: (() => void) | null = null;
			let mediaQuery: MediaQueryList | null = null;

			const setup = () => {
				if (currentCleanup) {
					currentCleanup();
					currentCleanup = null;
				}
				const isDesktop = mediaQuery
					? mediaQuery.matches
					: window.matchMedia("(min-width: 768px)").matches;
				currentCleanup = isDesktop
					? setupHorizontalScrollSmoothing("#scroll-container")
					: setupVerticalScrollSmoothing();
			};

			const attachMedia = () => {
				if (mediaQuery) return;
				mediaQuery = window.matchMedia("(min-width: 768px)");
				mediaQuery.addEventListener("change", setup);
			};

			document.addEventListener("astro:page-load", () => {
				attachMedia();
				setup();
			});

			document.addEventListener("astro:before-swap", () => {
				if (currentCleanup) {
					currentCleanup();
					currentCleanup = null;
				}
				if (mediaQuery) {
					mediaQuery.removeEventListener("change", setup);
					mediaQuery = null;
				}
			});
		</script>
	</div>
</BaseLayout>
