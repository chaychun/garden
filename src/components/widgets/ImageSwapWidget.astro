---
import Widget from "@/components/widgets/Widget.astro";
import ImageSwapMedia from "@/components/widgets/image-swap-media";
import { toCssHeight } from "@/lib/utils";

interface Props {
	title: string;
	images: string[];
	description?: string;
	types?: string[];
	id?: string;
	alt?: string;
	height?: string | number;
	aspect?: "portrait" | "landscape" | "square";
	intervalMs?: number;
	[key: string]: any;
}

const {
	title,
	images,
	description,
	types,
	id,
	alt,
	height,
	aspect = "portrait",
	intervalMs = 500,
	...rest
} = Astro.props as Props;

const href = id ? `/work/${encodeURIComponent(id)}/` : undefined;

const mediaHeightCss = toCssHeight(height);
const mediaWrapperStyle = `--media-h:${mediaHeightCss};`;

const aspectClass =
	aspect === "landscape"
		? "aspect-4/3"
		: aspect === "square"
			? "aspect-square"
			: "aspect-3/4"; // portrait default
---

<Widget
	class:list={[
		"flex max-w-[528px] flex-col gap-3 md:max-w-none md:justify-start",
		"mb-12 md:mb-0",
	]}
	{...rest}
>
	<div style={mediaWrapperStyle}>
		{
			href ? (
				<a
					href={href}
					class="block md:h-full md:w-full"
					aria-label={`View ${title}`}
					data-cursor-hover
					data-cursor-title={title}
				>
					<div
						class:list={[
							"relative w-full",
							aspectClass,
							"md:h-[var(--media-h)]",
						]}
					>
						<ImageSwapMedia
							client:load
							images={images}
							alt={alt || title}
							intervalMs={intervalMs}
							containerClassName="absolute inset-0 h-full w-full"
							className="absolute inset-0 h-full w-full object-cover"
						/>
					</div>
				</a>
			) : (
				<div
					class="block md:h-full md:w-full"
					data-cursor-hover
					data-cursor-title={title}
				>
					<div
						class:list={[
							"relative w-full",
							aspectClass,
							"md:h-[var(--media-h)]",
						]}
					>
						<ImageSwapMedia
							client:load
							images={images}
							alt={alt || title}
							intervalMs={intervalMs}
							containerClassName="absolute inset-0 h-full w-full"
							className="absolute inset-0 h-full w-full object-cover"
						/>
					</div>
				</div>
			)
		}
	</div>
</Widget>
